<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.naturemobility.api.dao.WelfareHistoryDao">

    <insert id="save" parameterType="WelfareHistoryDto" useGeneratedKeys="true" keyProperty="pid">
        INSERT INTO welfare_history (
          request_type, step, welfare_id, affiliate_pid, site_code, member_pid, result_code, result_msg,
          rsv_pnt, item_name, order_no, pay_amount, refund_amount, tno, payed_amount
        ) VALUE (
          #{requestType}, #{step}, #{welfareId}, #{affiliatePid}, #{siteCode}, #{memberPid}, #{resultCode}, #{resultMsg},
          #{rsvPnt}, #{itemName}, #{orderNo}, #{payAmount}, #{refundAmount}, #{tno}, #{payedAmount}
        )
    </insert>

    <select id="findPayedByTnoAndOrderNo" parameterType="Map" resultType="WelfareHistoryDto">
        SELECT
          pid, request_type, step, welfare_id, affiliate_pid, member_pid, result_code, result_msg,
          rsv_pnt, item_name, order_no, pay_amount, refund_amount, payed_amount, tno, reg_dtime
        FROM
          welfare_history
        WHERE
          step='OK_PAY'
          AND tno=#{tno}
          AND order_no=#{orderNo}
    </select>
</mapper>